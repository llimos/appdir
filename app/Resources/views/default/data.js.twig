var app = app || {};
app.data = {{ data|json_encode|raw }};

// Map everything
let map = {
    app: {
        deployments: "deployment",
        connections: "appConnection",
        inbound_connections: "appConnection",
    },
    deployment: {
        app: "app",
        connections: "deploymentConnection",
        inbound_connections: "deploymentConnection",
        servers: "server"
    },
    server: {
        deployments: "deployment"
    },
    appConnection: {
        client_app: "app",
        server_app: "app"
    },
    deploymentConnection: {
        client_deployment: "deployment",
        server_deployment: "deployment",
        connection: "appConnection"
    }
}

for (type in app.data) {
    let entities = app.data[type];
    let entityMap = map[type];
    for (entityId in entities) {
        entity = entities[entityId];
        for (mapType in entityMap) {
            let mappedEntity = app.data[entityMap[mapType]];
            if (entity[mapType]) {
                if (entity[mapType] instanceof Array) {
                    for (let i=0; i<entity[mapType].length; i++) {
                        entity[mapType][i] = mappedEntity[entity[mapType][i]];
                    }
                } else {
                    entity[mapType] = mappedEntity[entity[mapType]];
                }
            }
        }
    }
}